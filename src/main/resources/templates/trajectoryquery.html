<!DOCTYPE HTML>
<!--[if lte IE 6 ]> <html class="ie ie6 lte_ie7 lte_ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 7 ]> <html class="ie ie7 lte_ie7 lte_ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 8 ]> <html class="ie ie8 lte_ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 9 ]> <html class="ie ie9" lang="zh-CN"> <![endif]-->

<html lang="zh-CN">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="renderer" content="webkit" />
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title></title>
    <link rel="shortcut icon" href="http://statics.scnu.edu.cn/statics/images/favicon.ico" />

	<link rel="stylesheet" type="text/css" href="../static/easyui/themes/default/easyui.css" th:href="@{/easyui/themes/default/easyui.css}"></link>
	<link rel="stylesheet" type="text/css" href="../static/easyui/themes/icon.css" th:href="@{/easyui/themes/icon.css}"></link>
	<link rel="stylesheet" type="text/css" href="../static/easyui/demo/demo.css" th:href="@{/easyui/demo/demo.css}"></link>
	
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script type="text/javascript" src="../static/easyui/jquery.min.js" th:src="@{/easyui/jquery.min.js}"></script>
	<!-- jQuery easyui -->
	<script type="text/javascript" src="../static/easyui/jquery.easyui.min.js" th:src="@{/easyui/jquery.easyui.min.js}"></script>
	
	<link rel="stylesheet" type="text/css" href="../static/jsxgraph/jsxgraph.css" th:href="@{/jsxgraph/jsxgraph.css}"></link>
	<script type="text/javascript" src="../static/jsxgraph/jsxgraphcore.js" th:src="@{/jsxgraph/jsxgraphcore.js}"></script>
	<script type="text/javascript">
		function createRect(box, left, top, right, bottom) {
			var color = 'blue';
			var size = 0;
			var p1 = box.create('point', [left,top], {color:color, size:size, name:""}),
			    p2 = box.create('point', [right,bottom], {color:color, size:size, name:""}),
			    p3 = box.create('point', [function(){return p1.X()},function(){return p2.Y()}], {color:color, size:size, name:""}),
			    p4 = box.create('point', [function(){return p2.X()},function(){return p1.Y()}], {color:color, size:size, name:""}),
			    rect = box.create('polygon',[p1,p3,p2,p4],{hasInnerPoints:true});
				p1.isDraggable = false;
				p2.isDraggable = false;
				rect.isDraggable = true;
		}

	</script>
	
  	<script>
  	
  	function trajectoryQuery() {
  		var urlstr = $('#trajectory_graphId').val();
  		//alert(urlstr);
  		//alert(th:$(graphId));
  		var d1 = $('#trajectory_d1').numberbox('getValue');
  		var d2 = $('#trajectory_d2').numberbox('getValue');
  		var t1 = $('#trajectory_t1').numberbox('getValue');
  		var t2 = $('#trajectory_t2').numberbox('getValue');
  		//alert(d1+";"+d2+";"+t1+";"+t2);
  		var params = ";d1="+d1+";d2="+d2+";t1="+t1+";t2="+t2;

  		//alert('/rngraph/'+urlstr+params+'/query');
  		
  		$('#trajectory_dg').datagrid({
  		    url:'/rngraph/'+urlstr+'/queryresult',
  		  	method:'get',
  		  	//cache:false,
  		  	queryParams :
	  		  {
	  	  			d1:d1,
	  	  			d2:d2,
	  	  			t1:t1,
	  	  			t2:t2
	  	  		},
	  	  	fitColumns:true,
	  	  	autoRowHeight:false,
	  	  	//rownumbers:true,
	  	  	//sortName:"objId",
	  	  	//columns:[[{width:80}]],
  			onLoadError: function() {
                $.messager.show({
                    title:'错误消息',
                    msg:'查询失败'
                });
  			},
            onLoadSuccess:function(data){
                $.messager.show({
                    title:'消息',
                    msg:'成功查询 '+data.total+'条纪录'
                });
            }
  		});
  	}
  	
  	
  	function trajectoryQueryGraphView() {
  		var urlstr = $('#trajectory_graphId').val();

  		var d1 = $('#trajectory_d1').numberbox('getValue');
  		var d2 = $('#trajectory_d2').numberbox('getValue');
  		var t1 = $('#trajectory_t1').numberbox('getValue');
  		var t2 = $('#trajectory_t2').numberbox('getValue');
  		//alert(d1+";"+d2+";"+t1+";"+t2);
  		var params = ";d1="+d1+";d2="+d2+";t1="+t1+";t2="+t2;

  		$.ajax({
  		    url:'/rngraph/'+urlstr+'/queryresultgraphic',
  		  	type: "POST",
  		  	//dataType:"json",
  		  	data :
	  		  {
	  	  			d1:d1,
	  	  			d2:d2,
	  	  			t1:t1,
	  	  			t2:t2
	  	  		},
	  	  	success: function(dataJson, textStatus, jqXHR){
	  	  		var data = jQuery.parseJSON(dataJson);

                $.messager.show({
                    title:'消息',
                    msg:'成功查询 '+data.total+'条纪录'
                });
                window.top.queryResultGraphicView(dataJson);
            }
  		});
  	}
  	
  	</script>
  </head>
  <body>
    <div id="p" >
    	<div style="height:50px;width:100%;padding:0px;margin:0px; border: 0px; margin:0px;text-align:'center';">
    	<form>
    	<input id="trajectory_graphId" type="hidden" value="" th:value="${graphId}" />
    	空间跨度（整数）：
    	<input id="trajectory_d1" type="text" class="easyui-numberbox" value="" data-options="min:0,precision:0,required:false"></input>
    	，
    	<input id="trajectory_d2" type="text" class="easyui-numberbox" value="" data-options="min:0,precision:0,required:false"></input>
    	时间跨度（整数）：
    	<input id="trajectory_t1" type="text" class="easyui-numberbox" value="" data-options="min:0,precision:0,required:false"></input>
    	，
    	<input id="trajectory_t2" type="text" class="easyui-numberbox" value="" data-options="min:0,precision:0,required:false"></input>
    	 
    	<a href="#" class="easyui-linkbutton" onclick="javascript:trajectoryQuery()" data-options="iconCls:'icon-search'" style="width:120px">查询</a>
    	<a href="#" class="easyui-linkbutton" onclick="javascript:trajectoryQueryGraphView()" data-options="iconCls:'icon-search'" style="width:120px">可视化查询</a>
	    
	    </form>
	    </div>
	    <div class="easyui-layout" title="查询结果" style="width:100%;height:350px;padding:0px;"
	     	data-options="singleSelect:true, remoteSort:false,rownumbers:true,fitColumns:true,region:'west',collapsible:true">
			    <table id="trajectory_dg" class="easyui-datagrid" title="轨迹查询结果" style="width:100%;height:350px;padding: 0px;margin:0px"
			          data-options="singleSelect:true, remoteSort:false,rownumbers:true,fitColumns:true,region:'west',collapsible:true" >
			      <thead>
			          <tr >
			              <!--  <th data-options="field:'index',sortable:true,align:'right'" >序号</th> 
			              
			              
			              <th data-options="field:'p1.id',sortable:true,align:'right'">移动对象标识</th>
			              <th data-options="field:'p1.d',sortable:true,align:'right'">空间跨度起始</th>
			              <th data-options="field:'p2.d',sortable:true,align:'right'">空间跨度终止</th>
			              <th data-options="field:'p1.t',sortable:true,align:'right'">时间跨度起始</th>
			              <th data-options="field:'p2.t',sortable:true,align:'right'">时间跨度终止</th>
			              -->
			              
			              <th data-options="field:'objId',sortable:true,align:'center', " style="width:200px" >移动对象标识</th>
			              <th data-options="field:'d1',sortable:true,align:'right', " style="width:200px">空间跨度起始</th>
			              <th data-options="field:'d2',sortable:true,align:'right'," style="width:200px">空间跨度终止</th>
			              <th data-options="field:'t1',sortable:true,align:'right', " style="width:200px">时间跨度起始</th>
			              <th data-options="field:'t2',sortable:true,align:'right'," style="width:200px">时间跨度终止</th>
			          </tr>
			      </thead>
			    </table>
			    <!-- 
			    <div id="win" class="easyui-window" title="图形窗口" style=""
        				data-options="iconCls:'icon-save',modal:true,closed:true">
					<div id="box22" class="box22" data-options="region:'east',split:true,collapsible:true" style='width:1096px; height:500px;'></div>	
				</div>
				 -->
	    </div>
	 </div>
  </body>
</html>